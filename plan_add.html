<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width" , initial-scale="1">
  <title></title>
  <!-- <link rel="stylesheet" href="css/bootstrap.css">
  <link href="/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="/js/bootstrap.min.js"></script> -->
  <!-- JQuery CDN -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js" ?></script>
  <!-- 최신 자바스크립트 -->
  <script src="js/bootstrap.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/stylesheet.css">
  <link rel="stylesheet" href="css/style2.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css" />



  <link rel="stylesheet" href="plan_add.css">
  <title></title>
</head>

<body>
  <div class='container'>
    <div class='container_inner'>
      <h1>Plan add</h1>
      <br>
      <p></p>
      <fieldset>
        <div class="pl_cal">
          <!-- <input type="date" id="pl_date"></input> -->
          <input type="text" id="pl_date" placeholder="날짜를 선택하세요.">

        </div>
        <p></p>
        <div class='_field'>
          <input id=place maxlength='15' placeholder="장소를 입력해주세요! (15자 내)">
        </div>
        <p></p>
        <button id=addBtn>ADD</button>
      </fieldset>
      </br>
      <p> </p>
    </div>
  </div>
  <!--db-->
  <script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

  <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>
  <script type="text/javascript">
    var code = sessionStorage.getItem('CODE');
    //alert(code);
    var dayCnt;
    var day_y = new Array();
    var day_m = new Array();
    var day_d = new Array();
    var day_day = new Array();

    var sel_day;
    var start_y, start_m, start_d;
    var last_y, last_m, last_d;

    $.ajax({
      url: 'day_fetch_.php',
      type: 'POST',
      data: {
        code
      },
      success: function(result) {
        var temp = result.split(",");
        dayCnt = temp[0];
        var j = 1;
        console.log(dayCnt);

        for (var i = 0; i < dayCnt; i++) {
          day_y[i] = temp[j];
          j++;
          day_m[i] = temp[j];
          j++;
          day_d[i] = temp[j];
          j++;
          day_day[i] = temp[j];
          j++;

          if (day_day[i] == 1) {
            start_y = day_y[i];
            start_m = day_m[i]-1;
            start_d = day_d[i];
            //alert("start : " + start_y + "/" + start_m + "/" + start_d + " - " + day_day[i]);
            //console.log("start : " + start_y + "/" + start_m + "/" + start_d + " - " + day_day[i]);

          }
          if (day_day[i] == dayCnt) {
            last_y = day_y[i];
            last_m = day_m[i]-1;
            last_d = day_d[i];
            //alert("last : " + last_y + "/" + last_m + "/" + last_d + " - " + day_day[i]);
          }
}
        //alert(day_y[i] + "/" + day_m[i] + "/" + day_d[i] + " - " + day_day[i]);
      $(function() {
        $("#testDatepicker").datepicker({});
      });
      $(document).ready(function() {
        $.datepicker.setDefaults($.datepicker.regional['ko']);
        $("#pl_date").datepicker({
          changeMonth: true,
          changeYear: true,
          nextText: '다음 달',
          prevText: '이전 달',
          dayNames: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'],
          dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
          monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
          monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
          dateFormat: "yy-mm-dd",
          minDate: new Date(start_y, start_m, start_d),
          maxDate: new Date(last_y, last_m, last_d), // 선택할수있는 최소날짜, ( 0 : 오늘 이후 날짜 선택 불가)
          // onClose: function( selectedDate ) {
          //   //시작일(startDate) datepicker가 닫힐때
          //   //종료일(endDate)의 선택할수있는 최소 날짜(minDate)를 선택한 시작일로 지정
          //   $("#endDate").datepicker( "option", "minDate", selectedDate );
          // }

        });
      });
    },
    error: function(request, status, error) {
      alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
    }
    })
    /*
    버튼 변수 임시이름 addBtn
    일정 선택할 때 몇번째 day인지 가져와야함 ㅠ-ㅠ
    */
    $('#addBtn').click(function(e) {
      //

      var sel_y = $('#pl_date').datepicker('getDate').getFullYear();
      var sel_m = $('#pl_date').datepicker('getDate').getMonth() + 1;
      var sel_d = $('#pl_date').datepicker('getDate').getDate();


      for (var i = 0; i < dayCnt; i++) {
        if ((sel_y == day_y[i]) && (sel_m == day_m[i]) && (sel_d == day_d[i])) {
          sel_day = day_day[i];
          alert(sel_day);
          break;
        }
      }
      //
      $.ajax({
        url: 'plan_insert_.php',
        type: 'POST',
        data: {
          code,
          sel_day,
          place: $("#place").val()
        },
        success: function(result) {
          alert(result);
          //값 db에 넣고 창 닫기
          opener.document.location.reload();
          window.close();
        },
        error: function(request, status, error) {
          alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
        }
      })

    });
  </script>
  <!--db-->
</body>

</html>
